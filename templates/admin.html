<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin ‚Äî Collective for Life</title>
<style>
:root {
  --dark:#021024; --mid:#052659; --mist:#7DA0CA; --steam:#C1E8FF;
}
body {
  font-family:'Inter',sans-serif;
  background:var(--steam);
  margin:0; padding:20px; color:var(--dark);
}
h1 { text-align:center; margin-bottom:25px; }

form {
  display:flex; flex-wrap:wrap; justify-content:center; gap:10px;
  background:white; padding:15px; border-radius:12px;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
  max-width:900px; margin:auto;
}
.form-row {
  display:flex; align-items:center; gap:6px; flex:1 1 100%;
}
input,select {
  padding:10px 12px;
  border:1px solid var(--mid);
  border-radius:6px;
  font-size:15px;
  flex:1 1 auto;
  width:100%;
  min-width:120px;
}
input[type=file] {
  flex:1 1 100%;
  background:var(--steam);
  border:1px dashed var(--mid);
}
button {
  background:var(--mid);
  color:white;
  border:none;
  border-radius:6px;
  padding:10px 15px;
  cursor:pointer;
  flex:1 1 auto;
  min-width:100px;
  transition:.3s;
}
button:hover { background:var(--dark); }

.translate-btn, .add-cat-btn {
  background:var(--mist);
  color:var(--dark);
  border:none;
  padding:8px 12px;
  border-radius:6px;
  cursor:pointer;
  font-size:13px;
  flex:0 0 auto;
}
.translate-btn:hover, .add-cat-btn:hover {
  background:var(--mid); color:white;
}

.table-container {
  overflow-x:auto;
  margin-top:25px;
  max-width:95%;
  margin-left:auto;
  margin-right:auto;
}
table {
  width:100%;
  border-collapse:collapse;
  background:white;
  border-radius:10px;
  overflow:hidden;
}
th,td {
  border:1px solid var(--mist);
  padding:10px;
  text-align:center;
  vertical-align:middle;
}
th { background:var(--mid); color:white; font-weight:600; }
td img {
  max-width:60px;
  height:auto;
  border-radius:6px;
  cursor:pointer;
  transition:.3s;
}
td img:hover { transform:scale(1.05); }
a {
  color:#d11a2a;
  text-decoration:none;
  font-weight:bold;
}
a.edit { color:var(--mid); margin-right:8px; }

.modal {
  display:none;
  position:fixed;
  z-index:999;
  left:0; top:0;
  width:100%; height:100%;
  background:rgba(0,0,0,.85);
  justify-content:center;
  align-items:center;
}
.modal img {
  max-width:90%;
  max-height:85%;
  border-radius:12px;
  box-shadow:0 2px 20px rgba(255,255,255,.3);
}
@media(max-width:768px){
  form { flex-direction:column; align-items:stretch; padding:20px; }
  .form-row { flex-direction:column; align-items:stretch; }
  input,select,button { width:100%; font-size:16px; }
  th,td { font-size:13px; padding:8px; }
  button, .translate-btn, .add-cat-btn { width:100%; margin-top:4px; }
}
</style>
</head>
<body>
<h1>Admin Dashboard ‚Äî Collective for Life</h1>

<form method="POST" enctype="multipart/form-data" id="menuForm">

  <div class="form-row">
    <input type="text" name="name_en" id="name_en" placeholder="Name (English)" required>
    <button type="button" class="translate-btn" onclick="manualTranslate('en')">üåê‚ÜíAR</button>
  </div>

  <div class="form-row">
    <input type="text" name="name_ar" id="name_ar" placeholder="Name (Arabic)" required>
    <button type="button" class="translate-btn" onclick="manualTranslate('ar')">üåê‚ÜíEN</button>
  </div>

  <div class="form-row">
    <select name="category" id="categorySelect" required>
      <option value="" disabled selected>Category</option>
      {% for cat in categories %}
      <option>{{ cat }}</option>
      {% endfor %}
    </select>
    <button type="button" class="add-cat-btn" onclick="addCategory()">‚ûï Add</button>
    <button type="button" class="add-cat-btn" style="background:#d11a2a;color:white;" onclick="removeCategory()">üóëÔ∏è Delete</button>
  </div>

  <input type="text" name="origin" placeholder="Origin (e.g. Kenya)">
  <input type="text" name="process" placeholder="Process (e.g. Washed)">
  <input type="text" name="flavors" placeholder="Flavors (comma-separated)">
  <input type="text" name="price" placeholder="Price (KWD)" required>
  <input type="file" name="image" accept="image/*">
  <button type="submit">Add Item</button>
</form>

<div class="table-container">
<table>
  <tr>
    <th>#</th>
    <th>Image</th>
    <th>Category</th>
    <th>English</th>
    <th>Arabic</th>
    <th>Origin</th>
    <th>Process</th>
    <th>Flavors</th>
    <th>Price</th>
    <th>Actions</th>
  </tr>
  {% for item in menu_items %}
  <tr>
    <td>{{ loop.index }}</td>
    <td>
      {% if item['image'] %}
        <img src="{{ url_for('static', filename='uploads/' ~ item['image']) }}" 
             alt="img" onclick="showModal('{{ url_for('static', filename='uploads/' ~ item['image']) }}')">
      {% else %}
        <span style="color:#999;">No Image</span>
      {% endif %}
    </td>
    <td>{{ item['category'] }}</td>
    <td>{{ item['name_en'] }}</td>
    <td>{{ item['name_ar'] }}</td>
    <td>{{ item['origin'] or '-' }}</td>
    <td>{{ item['process'] or '-' }}</td>
    <td>{{ item['flavors'] or '-' }}</td>
    <td>{{ item['price'] }}</td>
    <td>
      <a class="edit" href="/edit/{{ item['id'] }}">‚úèÔ∏è Edit</a>
      <a href="/delete/{{ item['id'] }}">üóëÔ∏è Delete</a>
    </td>
  </tr>
  {% endfor %}
</table>
</div>

<div id="imageModal" class="modal" onclick="closeModal()">
  <img id="modalImage" src="" alt="Preview">
</div>

<script>
// üß† Auto-translation while typing
let typingTimeout;
['name_en','name_ar'].forEach(id=>{
  const input=document.getElementById(id);
  input.addEventListener('input',()=>{
    clearTimeout(typingTimeout);
    typingTimeout=setTimeout(()=>autoTranslate(id),600);
  });
});

// üåê Auto translate (EN‚ÜîAR) using target for real Arabic output
async function autoTranslate(sourceId){
  const en=document.getElementById('name_en');
  const ar=document.getElementById('name_ar');
  let text='', target='';
  if(sourceId==='name_en' && en.value.trim()!==''){ text=en.value.trim(); target='ar'; }
  else if(sourceId==='name_ar' && ar.value.trim()!==''){ text=ar.value.trim(); target='en'; }
  else return;

  const res=await fetch('/translate',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({text, target})
  });
  const data=await res.json();
  if(data.translated){
    if(target==='ar') ar.value=data.translated;
    else en.value=data.translated;
  }
}

// üåê Manual translation buttons (EN‚ÜíAR or AR‚ÜíEN)
async function manualTranslate(lang){
  const en=document.getElementById('name_en');
  const ar=document.getElementById('name_ar');
  let text='', target='';
  if(lang==='en'){ text=en.value.trim(); target='ar'; }
  else{ text=ar.value.trim(); target='en'; }
  if(!text) return alert("Enter text first!");

  const res=await fetch('/translate',{
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({text, target})
  });
  const data=await res.json();
  if(data.translated){
    if(target==='ar') ar.value=data.translated;
    else en.value=data.translated;
  }
}

// ‚ûï Add / üóëÔ∏è Delete categories
async function addCategory(){
  const select=document.getElementById('categorySelect');
  const newCat=prompt("Enter new category name:");
  if(!newCat)return;
  const res=await fetch('/categories/add',{
    method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({name:newCat})
  });
  const data=await res.json();
  if(data.status==="added"){
    const opt=document.createElement('option');
    opt.textContent=newCat;opt.value=newCat;
    select.appendChild(opt);select.value=newCat;
    alert(`Category "${newCat}" added.`);
  }else alert("Error adding category.");
}
async function removeCategory(){
  const select=document.getElementById('categorySelect');
  const selected=select.value;
  if(!selected)return alert("Select category to delete.");
  if(!confirm(`Delete category "${selected}"?`))return;
  const res=await fetch('/categories/delete',{
    method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({name:selected})
  });
  const data=await res.json();
  if(data.status==="deleted"){
    select.querySelector(`option[value="${selected}"]`).remove();
    select.selectedIndex=0;
    alert(`"${selected}" deleted.`);
  }else alert("Error deleting category.");
}

// üñºÔ∏è Image modal
function showModal(src){
  const m=document.getElementById('imageModal');
  const img=document.getElementById('modalImage');
  img.src=src; m.style.display="flex";
}
function closeModal(){document.getElementById('imageModal').style.display="none";}
</script>
</body>
</html>
