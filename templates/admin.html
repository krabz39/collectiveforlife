<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Admin ‚Äî Collective for Life</title>

<style>
:root {
  --dark:#021024; 
  --mid:#052659; 
  --mist:#7DA0CA; 
  --steam:#C1E8FF;
}
body {
  font-family:'Inter',sans-serif;
  background:var(--steam);
  margin:0; padding:20px; 
  color:var(--dark);
}

/* ------------------------------
   HEADER CENTERED (NO OVERLAP)
-------------------------------- */
header {
  text-align:center;
  max-width:900px;
  margin:0 auto 10px auto;
}
header h1 {
  margin:0;
  font-size:22px;
  font-weight:700;
}

/* Button Row BELOW header */
.header-actions {
  margin:10px auto 25px auto;
  max-width:900px;
  display:flex;
  justify-content:center;
  gap:10px;
}

/* Buttons */
.small-btn {
  padding:6px 12px;
  font-size:13px;
  border-radius:6px;
  border:none;
  cursor:pointer;
  background:var(--mid);
  color:white;
  text-decoration:none;
  transition:.3s;
}
.small-btn:hover { background:var(--dark); }

/* Form + Inputs */
form {
  display:flex; 
  flex-wrap:wrap; 
  justify-content:center; 
  gap:10px;
  background:white; 
  padding:15px; 
  border-radius:12px;
  box-shadow:0 2px 8px rgba(0,0,0,.1);
  max-width:900px; 
  margin:auto;
}
.form-row { display:flex; gap:6px; flex:1 1 100%; }
input,select {
  padding:10px 12px;
  border:1px solid var(--mid);
  border-radius:6px;
  font-size:15px;
  width:100%;
}
input[type=file] {
  background:var(--steam);
  border:1px dashed var(--mid);
}
button {
  background:var(--mid);
  color:white;
  border:none;
  border-radius:6px;
  padding:10px 15px;
  cursor:pointer;
  transition:.3s;
}
button:hover { background:var(--dark); }

/* Translate + Category buttons */
.translate-btn, .add-cat-btn {
  background:var(--mist);
  color:var(--dark);
}
.translate-btn:hover, .add-cat-btn:hover {
  background:var(--mid); color:white;
}

/* Table */
.table-container {
  overflow-x:auto;
  margin-top:25px;
  max-width:95%;
  margin:auto;
}
table {
  width:100%;
  border-collapse:collapse;
  background:white;
  border-radius:10px;
  overflow:hidden;
}
th,td {
  border:1px solid var(--mist);
  padding:10px;
  text-align:center;
}
th { background:var(--mid); color:white; }

td img {
  max-width:60px;
  border-radius:6px;
  cursor:pointer;
  transition:.3s;
}
td img:hover { transform:scale(1.05); }

a.edit { color:var(--mid); font-weight:bold; }
a { color:#d11a2a; text-decoration:none; font-weight:bold; }

/* Modal */
.modal {
  display:none;
  position:fixed;
  z-index:999;
  left:0; top:0;
  width:100%; height:100%;
  background:rgba(0,0,0,.85);
  justify-content:center;
  align-items:center;
}
.modal img {
  max-width:90%;
  max-height:85%;
  border-radius:12px;
}

/* Mobile */
@media(max-width:768px){
  .header-actions { flex-direction:column; }
  .small-btn { width:100%; text-align:center; }
  form { padding:20px; }
  table { font-size:13px; }
}
</style>
</head>
<body>

<!-- HEADER -->
<header>
  <h1>Admin Dashboard ‚Äî Collective for Life</h1>
</header>

<!-- BUTTONS BELOW HEADER -->
<div class="header-actions">
  <a href="/menu" class="small-btn">‚Üê Menu</a>
  <button class="small-btn" id="adminTranslateBtn">üåê Arabic</button>
  <!-- NEW BACKGROUND BUTTON -->
  <button class="small-btn" onclick="window.location.href='/admin/background'">üé® Background</button>
</div>

<!-- FORM -->
<form method="POST" enctype="multipart/form-data" id="menuForm">

  <div class="form-row">
    <input type="text" name="name_en" id="name_en" placeholder="Name (English)">
    <button type="button" class="translate-btn" onclick="manualTranslate('en')">‚Üí AR</button>
  </div>

  <div class="form-row">
    <input type="text" name="name_ar" id="name_ar" placeholder="Name (Arabic)">
    <button type="button" class="translate-btn" onclick="manualTranslate('ar')">‚Üí EN</button>
  </div>

  <div class="form-row">
    <select name="category" id="categorySelect">
      <option value="" disabled selected>Category</option>
      {% for cat in categories %}
      <option>{{ cat }}</option>
      {% endfor %}
    </select>
    <button type="button" class="add-cat-btn" onclick="addCategory()">Add</button>
    <button type="button" class="add-cat-btn" style="background:#d11a2a;color:white;" onclick="removeCategory()">Delete</button>
  </div>

  <input type="text" name="origin" placeholder="Origin">
  <input type="text" name="process" placeholder="Process">
  <input type="text" name="flavors" placeholder="Flavors">
  <input type="text" name="price" placeholder="Price (KWD)">
  <input type="file" name="image">

  <button type="submit">Add Item</button>
</form>

<!-- TABLE -->
<div class="table-container">
<table>
  <tr>
    <th>#</th><th>Image</th><th>Category</th><th>EN</th><th>AR</th>
    <th>Origin</th><th>Process</th><th>Flavors</th><th>Price</th><th>Actions</th>
  </tr>
  {% for item in menu_items %}
  <tr>
    <td>{{ loop.index }}</td>
    <td>
      {% if item['image'] %}
      <img src="{{ url_for('static', filename='uploads/' ~ item['image']) }}"
           onclick="showModal('{{ url_for('static', filename='uploads/' ~ item['image']) }}')">
      {% else %}
      <span style="color:#999;">No Image</span>
      {% endif %}
    </td>
    <td>{{ item['category'] }}</td>
    <td>{{ item['name_en'] }}</td>
    <td>{{ item['name_ar'] }}</td>
    <td>{{ item['origin'] or '-' }}</td>
    <td>{{ item['process'] or '-' }}</td>
    <td>{{ item['flavors'] or '-' }}</td>
    <td>{{ item['price'] }}</td>
    <td>
      <a class="edit" href="/edit/{{ item['id'] }}">‚úèÔ∏è</a>
      <a href="/delete/{{ item['id'] }}">üóëÔ∏è</a>
    </td>
  </tr>
  {% endfor %}
</table>
</div>

<!-- IMAGE MODAL -->
<div id="imageModal" class="modal" onclick="closeModal()">
  <img id="modalImage" src="">
</div>

<script>
/* FULL PAGE TRANSLATION */
async function translateAdminPage(target){
  const walker=document.createTreeWalker(document.body,NodeFilter.SHOW_TEXT);
  const texts=[], nodes=[];
  while(walker.nextNode()){
    const node=walker.currentNode;
    const txt=node.nodeValue.trim();
    if(txt && !['SCRIPT','STYLE'].includes(node.parentNode.tagName)){
      texts.push(txt); nodes.push(node);
    }
  }
  const res=await fetch('/translate_all',{
    method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({texts,target})
  });
  const data=await res.json();
  data.translations.forEach((t,i)=>{ if(nodes[i]) nodes[i].nodeValue=t; });
}

/* Toggle Arabic/English */
document.getElementById("adminTranslateBtn")
.addEventListener("click", async ()=>{
  const btn=document.getElementById("adminTranslateBtn");
  const toArabic = btn.textContent.includes("Arabic");
  const target = toArabic ? "ar" : "en";
  btn.textContent = toArabic ? "English" : "Arabic";
  document.documentElement.dir = toArabic ? "rtl" : "ltr";
  await translateAdminPage(target);
});

/* Field Instant Translation */
async function manualTranslate(lang){
  const en=document.getElementById('name_en');
  const ar=document.getElementById('name_ar');
  let text='', target='';
  if(lang==='en'){ text=en.value; target='ar'; }
  else{ text=ar.value; target='en'; }
  if(!text)return;
  const res=await fetch('/translate',{
    method:'POST',headers:{'Content-Type':'application/json'},
    body:JSON.stringify({text,target})
  });
  const d=await res.json();
  if(target==='ar') ar.value=d.translated;
  else en.value=d.translated;
}

/* Image Modal */
function showModal(src){
  document.getElementById("modalImage").src=src;
  document.getElementById("imageModal").style.display="flex";
}
function closeModal(){
  document.getElementById("imageModal").style.display="none";
}
</script>

</body>
</html>
